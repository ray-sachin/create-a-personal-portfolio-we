<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Portfolio</title>
  <meta name="description" content="Personal portfolio website." />
  <style>
    :root{
      --bg: #0f1220;
      --panel: #161a2e;
      --muted: #8891aa;
      --text: #e6e9f2;
      --primary: #6c5ce7;
      --primary-600: #5a4bd1;
      --accent: #20c997;
      --chip: #1e2342;
      --chip-border: #2a315a;
      --card: #12162a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
      --radius-sm: 10px;
      --radius-xs: 8px;
      --maxw: 1100px;
    }
    html,body{margin:0;padding:0;color:var(--text);background:linear-gradient(180deg,#0d1120 0%, #0c0f1b 100%);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    a{color:var(--primary);text-decoration:none}
    a:hover{color:var(--primary-600)}
    img{max-width:100%;display:block}
    .container{max-width:var(--maxw);margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;backdrop-filter:blur(12px);background:rgba(10,12,22,.5);border-bottom:1px solid rgba(255,255,255,.06);z-index:40}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:36px;height:36px;border-radius:50%;background:radial-gradient(120% 120% at 30% 30%, var(--primary) 0%, #3c38a1 45%, #1a1846 100%);box-shadow:inset 0 0 20px rgba(255,255,255,.08), var(--shadow)}
    .brand h1{font-size:18px;margin:0}
    nav a{margin-left:18px;color:var(--text);opacity:.9}
    nav a:hover{opacity:1}
    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:32px;align-items:center;padding:56px 0}
    .hero-card{background:linear-gradient(160deg,rgba(255,255,255,.04),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:26px 26px 26px 26px;box-shadow:var(--shadow)}
    .hero h2{font-size:40px;letter-spacing:.2px;margin:6px 0 8px}
    .muted{color:var(--muted)}
    .hero-cta{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#151a30;color:var(--text)}
    .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
    .btn.primary:hover{background:var(--primary-600)}
    .btn:hover{transform:translateY(-1px)}
    .avatar-wrap{position:relative}
    .avatar{aspect-ratio:1/1;border-radius:18px;border:1px solid rgba(255,255,255,.08);background:#0d1120;object-fit:cover;box-shadow:var(--shadow)}
    .ring{position:absolute;inset:auto auto 14px 14px;background:rgba(32,201,151,.14);border:1px solid rgba(32,201,151,.3);padding:10px 12px;border-radius:12px;font-size:13px}
    section{padding:30px 0}
    .section-title{font-size:22px;margin:4px 0 14px}
    .about{display:grid;grid-template-columns:1fr;gap:10px}
    .panel{background:linear-gradient(160deg,rgba(255,255,255,.04),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
    .chips{display:flex;flex-wrap:wrap;gap:10px}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;background:var(--chip);border:1px solid var(--chip-border);border-radius:999px;font-size:14px}
    .chip .remove{display:none}
    .projects{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .card{background:linear-gradient(160deg,rgba(255,255,255,.04),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);overflow:hidden;display:flex;flex-direction:column}
    .card .thumb{height:160px;background:#0c1020;display:block;object-fit:cover}
    .card-body{padding:16px;display:flex;flex-direction:column;gap:10px;flex:1}
    .tags{display:flex;flex-wrap:wrap;gap:8px}
    .tag{font-size:12px;padding:5px 8px;border-radius:999px;background:#151a30;border:1px solid rgba(255,255,255,.08);color:#cbd3ee}
    .links{display:flex;gap:10px;margin-top:auto}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .contact{display:grid;grid-template-columns:1fr .9fr;gap:16px;align-items:start}
    .contact .panel{height:100%}
    footer{padding:30px 0 60px;color:var(--muted);border-top:1px solid rgba(255,255,255,.06);margin-top:24px}
    .socials{display:flex;gap:12px;margin-top:10px}
    .pill{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.12)}
    /* Edit mode */
    .edit-toggle{position:fixed;right:20px;bottom:20px;z-index:60;background:var(--primary);color:#fff;border:none;border-radius:999px;padding:12px 16px;display:flex;align-items:center;gap:8px;box-shadow:var(--shadow);cursor:pointer}
    .editbar{position:fixed;left:0;right:0;top:0;z-index:80;display:none;align-items:center;gap:10px;justify-content:space-between;background:rgba(9,12,22,.9);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.1);padding:8px 12px}
    .editbar .grp{display:flex;gap:8px;align-items:center}
    .editbar .btn{background:#0f1326}
    .editbar input[type="color"]{width:36px;height:32px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:#0f1326;padding:2px}
    [data-edit="text"]{transition:box-shadow .2s,border-color .2s}
    body.editing [data-edit]{outline:1px dashed rgba(255,255,255,.25);outline-offset:2px;border-radius:8px}
    body.editing [data-edit="text"]:focus{outline:2px solid var(--accent);background:rgba(32,201,151,.08)}
    body.editing a[data-edit], body.editing img[data-edit]{position:relative;cursor:pointer}
    .hint{display:none;position:absolute;right:6px;top:6px;font-size:11px;background:rgba(0,0,0,.55);padding:3px 6px;border-radius:6px;border:1px solid rgba(255,255,255,.14);pointer-events:none}
    body.editing [data-edit] .hint, body.editing a[data-edit]::after{display:block}
    body.editing .chip .remove{display:inline-flex;color:#fff;background:#d9534f;border:none;border-radius:6px;padding:0 6px;height:20px;align-items:center;cursor:pointer}
    .add-chip{display:none}
    body.editing .add-chip{display:inline-flex}
    .sr{position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap}
    .hidden{display:none}
    @media (max-width: 980px){
      .hero{grid-template-columns:1fr;gap:14px}
      .projects{grid-template-columns:1fr 1fr}
      .contact{grid-template-columns:1fr}
    }
    @media (max-width: 640px){
      .projects{grid-template-columns:1fr}
      nav{display:none}
      .hero h2{font-size:32px}
    }
  </style>
</head>
<body>
  <div class="editbar" id="editbar" aria-hidden="true">
    <div class="container" style="display:flex;justify-content:space-between;gap:10px;align-items:center">
      <div class="grp">
        <strong>Edit mode</strong>
        <label class="pill" style="display:flex;align-items:center;gap:8px;padding:6px 10px">
          <span>Theme</span>
          <input type="color" id="themeColor" title="Theme primary color" />
        </label>
      </div>
      <div class="grp">
        <button class="btn" id="saveBtn">Save</button>
        <button class="btn" id="exportBtn">Export JSON</button>
        <label class="btn" for="importInput" style="cursor:pointer">Import JSON</label>
        <input id="importInput" class="sr" type="file" accept="application/json" />
        <button class="btn" id="resetBtn" title="Reset to template defaults">Reset</button>
        <button class="btn primary" id="exitEditBtn">Exit edit</button>
      </div>
    </div>
  </div>

  <button class="edit-toggle" id="editToggle" aria-pressed="false" title="Toggle edit mode">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z" fill="#fff"/></svg>
    Edit
  </button>

  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1 id="site-title" data-edit="text" data-key="hero.name">Your Name</h1>
      </div>
      <nav aria-label="Primary">
        <a href="#about">About</a>
        <a href="#projects">Projects</a>
        <a href="#skills">Skills</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container hero">
      <div class="hero-card">
        <div class="muted" id="hero-tagline" data-edit="text" data-key="hero.tagline">Hi, I’m</div>
        <h2 id="hero-name" data-edit="text" data-key="hero.name">Your Name</h2>
        <div class="muted" id="hero-role" data-edit="text" data-key="hero.role">Full-Stack Developer</div>
        <p id="hero-bio" data-edit="text" data-key="hero.bio">
          I build fast, accessible, and delightful web experiences with a focus on clean design and robust engineering.
        </p>
        <div class="hero-cta">
          <a id="resume-link" class="btn primary" href="#" target="_blank" rel="noopener" data-edit="href" data-key="hero.resumeHref">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M5 20h14v-2H5v2zM12 2l-5.5 9h11L12 2z"/></svg>
            Download Resume
            <span class="hint">Edit link</span>
          </a>
          <a id="contact-btn" class="btn" href="#" data-edit="email" data-key="contact.email">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12a2 2 0 0 0 2 2h16c1.1 0 2-.9 2-2V6a2 2 0 0 0-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg>
            Email Me
            <span class="hint">Edit email</span>
          </a>
        </div>
      </div>
      <div class="avatar-wrap">
        <img id="avatar" class="avatar" alt="Profile photo" src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='600' height='600'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%236c5ce7'/><stop offset='100%' stop-color='%23333883'/></linearGradient></defs><rect width='100%25' height='100%25' fill='%2310142a'/><circle cx='300' cy='260' r='120' fill='url(%23g)' opacity='.8'/><rect x='220' y='360' rx='40' ry='40' width='160' height='180' fill='%23333f8a' opacity='.7'/></svg>" data-edit="src" data-key="hero.avatarSrc"/>
        <div class="ring">Available for work</div>
      </div>
    </div>

    <section id="about" class="container">
      <h3 class="section-title">About</h3>
      <div class="about panel">
        <p id="about-text" data-edit="text" data-key="about.text">
          I’m a software engineer with a passion for crafting intuitive interfaces and resilient backends. I care about performance, accessibility, and great developer experience.
        </p>
        <div class="grid-2">
          <div>
            <strong>Location</strong>
            <div id="about-location" class="muted" data-edit="text" data-key="contact.location">Your City, Country</div>
          </div>
          <div>
            <strong>Social</strong>
            <div class="socials">
              <a id="gh-link" class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="socials.github">GitHub</a>
              <a id="ln-link" class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="socials.linkedin">LinkedIn</a>
              <a id="tw-link" class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="socials.twitter">Twitter</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="skills" class="container">
      <h3 class="section-title">Skills</h3>
      <div class="panel">
        <div class="chips" id="skills-list">
          <!-- skills chips generated -->
        </div>
        <button class="btn add-chip" id="add-skill">+ Add skill</button>
      </div>
    </section>

    <section id="projects" class="container">
      <h3 class="section-title">Projects</h3>
      <div class="projects">
        <article class="card" data-entity="project" data-project-index="0">
          <img class="thumb" alt="Project cover" src="https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=1200&auto=format&fit=crop" data-edit="src" data-key="projects.0.image"/>
          <div class="card-body">
            <h4 data-edit="text" data-key="projects.0.title">Project One</h4>
            <p class="muted" data-edit="text" data-key="projects.0.description">A short description of what this project does and why it’s useful.</p>
            <div class="tags" id="tags-0">
              <span class="tag" data-edit="text" data-key="projects.0.tags.0">React</span>
              <span class="tag" data-edit="text" data-key="projects.0.tags.1">Node.js</span>
              <span class="tag" data-edit="text" data-key="projects.0.tags.2">PostgreSQL</span>
            </div>
            <div class="links">
              <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="projects.0.demo">Live</a>
              <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="projects.0.repo">Code</a>
            </div>
          </div>
        </article>
        <article class="card" data-entity="project" data-project-index="1">
          <img class="thumb" alt="Project cover" src="https://images.unsplash.com/photo-1461749280684-dccba630e2f6?q=80&w=1200&auto=format&fit=crop" data-edit="src" data-key="projects.1.image"/>
          <div class="card-body">
            <h4 data-edit="text" data-key="projects.1.title">Project Two</h4>
            <p class="muted" data-edit="text" data-key="projects.1.description">What problem it solves, the stack, and the key features.</p>
            <div class="tags" id="tags-1">
              <span class="tag" data-edit="text" data-key="projects.1.tags.0">TypeScript</span>
              <span class="tag" data-edit="text" data-key="projects.1.tags.1">Express</span>
              <span class="tag" data-edit="text" data-key="projects.1.tags.2">Redis</span>
            </div>
            <div class="links">
              <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="projects.1.demo">Live</a>
              <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="projects.1.repo">Code</a>
            </div>
          </div>
        </article>
        <article class="card" data-entity="project" data-project-index="2">
          <img class="thumb" alt="Project cover" src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=1200&auto=format&fit=crop" data-edit="src" data-key="projects.2.image"/>
          <div class="card-body">
            <h4 data-edit="text" data-key="projects.2.title">Project Three</h4>
            <p class="muted" data-edit="text" data-key="projects.2.description">Briefly highlight outcomes, metrics, or unique aspects.</p>
            <div class="tags" id="tags-2">
              <span class="tag" data-edit="text" data-key="projects.2.tags.0">Next.js</span>
              <span class="tag" data-edit="text" data-key="projects.2.tags.1">Tailwind</span>
              <span class="tag" data-edit="text" data-key="projects.2.tags.2">Vercel</span>
            </div>
            <div class="links">
              <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="projects.2.demo">Live</a>
              <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="projects.2.repo">Code</a>
            </div>
          </div>
        </article>
      </div>
    </section>

    <section id="contact" class="container">
      <h3 class="section-title">Contact</h3>
      <div class="contact">
        <div class="panel">
          <p>Want to collaborate or just say hi? I’d love to hear from you.</p>
          <p>
            <strong>Email: </strong>
            <a id="contact-email" href="#" data-edit="email" data-key="contact.email">you@example.com</a>
          </p>
          <p><strong>Location: </strong><span id="contact-location" data-edit="text" data-key="contact.location">Your City, Country</span></p>
          <div class="socials">
            <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="socials.github">GitHub</a>
            <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="socials.linkedin">LinkedIn</a>
            <a class="pill" href="#" target="_blank" rel="noopener" data-edit="href" data-key="socials.twitter">Twitter</a>
          </div>
        </div>
        <div class="panel">
          <form id="contact-form" onsubmit="return composeMailto(event)">
            <div class="grid-2">
              <label>
                <div class="muted">Your name</div>
                <input name="name" required placeholder="Jane Doe" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0f1326;color:#fff"/>
              </label>
              <label>
                <div class="muted">Your email</div>
                <input name="from" type="email" required placeholder="you@domain.com" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0f1326;color:#fff"/>
              </label>
            </div>
            <label>
              <div class="muted">Message</div>
              <textarea name="message" rows="5" required placeholder="Hello! I'd like to chat about..."
                style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0f1326;color:#fff"></textarea>
            </label>
            <div style="margin-top:12px">
              <button class="btn primary" type="submit">Send message</button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <footer class="container">
    <div>&copy; <span id="year"></span> <span data-edit="text" data-key="hero.name">Your Name</span>. All rights reserved.</div>
  </footer>

  <script>
    // Default template data
    const defaultData = {
      theme: { primary: getComputedStyle(document.documentElement).getPropertyValue('--primary').trim() || '#6c5ce7' },
      hero: {
        name: 'Your Name',
        role: 'Full-Stack Developer',
        tagline: 'Hi, I’m',
        bio: 'I build fast, accessible, and delightful web experiences with a focus on clean design and robust engineering.',
        resumeHref: '#',
        avatarSrc: document.getElementById('avatar')?.getAttribute('src') || ''
      },
      about: {
        text: 'I’m a software engineer with a passion for crafting intuitive interfaces and resilient backends. I care about performance, accessibility, and great developer experience.'
      },
      contact: {
        email: 'you@example.com',
        location: 'Your City, Country'
      },
      socials: {
        github: '#',
        linkedin: '#',
        twitter: '#'
      },
      skills: ['HTML','CSS','JavaScript','TypeScript','React','Node.js','Express','PostgreSQL','Docker'],
      projects: [
        {
          title: 'Project One',
          description: 'A short description of what this project does and why it’s useful.',
          image: document.querySelector('[data-key="projects.0.image"]')?.getAttribute('src') || '',
          tags: ['React','Node.js','PostgreSQL'],
          demo: '#',
          repo: '#'
        },
        {
          title: 'Project Two',
          description: 'What problem it solves, the stack, and the key features.',
          image: document.querySelector('[data-key="projects.1.image"]')?.getAttribute('src') || '',
          tags: ['TypeScript','Express','Redis'],
          demo: '#',
          repo: '#'
        },
        {
          title: 'Project Three',
          description: 'Briefly highlight outcomes, metrics, or unique aspects.',
          image: document.querySelector('[data-key="projects.2.image"]')?.getAttribute('src') || '',
          tags: ['Next.js','Tailwind','Vercel'],
          demo: '#',
          repo: '#'
        }
      ]
    };

    // Utilities
    const STORAGE_KEY = 'portfolioDataV1';
    const $ = (sel, ctx=document) => ctx.querySelector(sel);
    const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const deepMerge = (base, override) => {
      if (Array.isArray(base)) return Array.isArray(override) ? override.slice() : base.slice();
      const out = {...base};
      for (const k in override || {}) {
        if (override[k] && typeof override[k] === 'object' && !Array.isArray(override[k])) {
          out[k] = deepMerge(base[k] || {}, override[k]);
        } else {
          out[k] = override[k];
        }
      }
      return out;
    };

    const loadData = () => {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return structuredClone(defaultData);
        const parsed = JSON.parse(raw);
        return deepMerge(defaultData, parsed);
      } catch { return structuredClone(defaultData); }
    };
    const saveData = (data) => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    };

    // Apply data to DOM
    function applyTheme(primary) {
      document.documentElement.style.setProperty('--primary', primary);
      document.documentElement.style.setProperty('--primary-600', shadeColor(primary, -10));
    }
    function shadeColor(color, percent) {
      // color #rrggbb, percent -100..100
      const f = parseInt(color.slice(1),16), t = percent<0?0:255, p = Math.abs(percent)/100;
      const R = f>>16, G = f>>8&0x00FF, B = f&0x0000FF;
      const v = (x)=>Math.round((t-x)*p)+x;
      return '#' + (0x1000000 + (v(R)<<16) + (v(G)<<8) + v(B)).toString(16).slice(1);
    }

    function renderSkills(skills) {
      const wrap = $('#skills-list');
      wrap.innerHTML = '';
      skills.forEach((s, i) => {
        const el = document.createElement('span');
        el.className = 'chip';
        el.setAttribute('data-edit', 'text');
        el.setAttribute('data-key', `skills.${i}`);
        el.contentEditable = 'false';
        el.innerText = s;
        const remove = document.createElement('button');
        remove.type = 'button';
        remove.className = 'remove';
        remove.textContent = '×';
        remove.title = 'Remove';
        remove.addEventListener('click', (e)=>{ e.stopPropagation(); removeSkill(i); });
        el.appendChild(remove);
        wrap.appendChild(el);
      });
    }
    function removeSkill(index) {
      currentData.skills.splice(index,1);
      renderSkills(currentData.skills);
      if (document.body.classList.contains('editing')) enableEditable();
    }

    function applyData(data) {
      applyTheme(data.theme.primary || defaultData.theme.primary);
      // Text fields
      $$('[data-edit="text"]').forEach(el => {
        const key = el.dataset.key;
        const val = getByKey(data, key);
        if (typeof val === 'string') el.innerText = val;
      });
      // Hrefs
      $$('[data-edit="href"]').forEach(el => {
        const key = el.dataset.key;
        const val = getByKey(data, key) || '#';
        el.setAttribute('href', val);
      });
      // Email fields
      $$('[data-edit="email"]').forEach(el => {
        const email = data.contact?.email || defaultData.contact.email;
        el.setAttribute('href', `mailto:${email}`);
        el.textContent = email;
      });
      // Images
      $$('img[data-edit="src"]').forEach(img => {
        const key = img.dataset.key;
        const src = getByKey(data, key);
        if (src) img.src = src;
      });
      // Skills
      renderSkills(data.skills || []);
      // Projects tags if changed lengths
      (data.projects || []).forEach((p, i)=>{
        const tagsWrap = $(`#tags-${i}`);
        if (!tagsWrap) return;
        const currentTags = $$('.tag', tagsWrap);
        if (currentTags.length !== (p.tags?.length || 0)) {
          tagsWrap.innerHTML = '';
          (p.tags||[]).forEach((t, j)=>{
            const span = document.createElement('span');
            span.className='tag';
            span.setAttribute('data-edit','text');
            span.setAttribute('data-key', `projects.${i}.tags.${j}`);
            span.textContent = t;
            tagsWrap.appendChild(span);
          });
        } else {
          (p.tags||[]).forEach((t, j)=>{
            const el = $(`[data-key="projects.${i}.tags.${j}"]`);
            if (el) el.textContent = t;
          });
        }
      });
      // Update year
      $('#year').textContent = String(new Date().getFullYear());
    }

    function getByKey(obj, dotted) {
      return dotted.split('.').reduce((o,k)=> (o && typeof o==='object') ? o[k] : undefined, obj);
    }
    function setByKey(obj, dotted, value) {
      const parts = dotted.split('.');
      const last = parts.pop();
      const target = parts.reduce((o,k)=> (o[k] ??= {}), obj);
      target[last] = value;
    }

    // Collect data back from DOM (for Save)
    function collectData() {
      const data = structuredClone(currentData);
      // Text
      $$('[data-edit="text"]').forEach(el=>{
        const key = el.dataset.key;
        if (!key) return;
        const val = el.innerText.trim();
        // For chips in skills we manage separately
        if (!key.startsWith('skills.')) setByKey(data, key, val);
      });
      // Href
      $$('[data-edit="href"]').forEach(el=>{
        const key = el.dataset.key;
        setByKey(data, key, el.getAttribute('href') || '#');
      });
      // Email
      const email = data.contact?.email || defaultData.contact.email;
      $$('[data-edit="email"]').forEach(el=>{
        const key = el.dataset.key || 'contact.email';
        setByKey(data, key, el.textContent.trim() || email);
      });
      // Images
      $$('img[data-edit="src"]').forEach(img=>{
        const key = img.dataset.key;
        setByKey(data, key, img.getAttribute('src') || '');
      });
      // Skills from chips
      const skills = [];
      $$('#skills-list .chip').forEach(chip=>{
        const textNode = Array.from(chip.childNodes).find(n=>n.nodeType===3);
        const val = (textNode ? textNode.nodeValue : chip.firstChild?.nodeType===3 ? chip.firstChild.nodeValue : chip.textContent)?.trim();
        if (val) skills.push(val.replace(/×$/, '').trim());
      });
      data.skills = skills;
      // Project tags
      (data.projects||[]).forEach((p,i)=>{
        const wrap = $(`#tags-${i}`);
        if (!wrap) return;
        const tags = $$('.tag', wrap).map(el=>el.textContent.trim());
        p.tags = tags;
      });
      return data;
    }

    // Edit Mode handlers
    function enableEditable() {
      $$('[data-edit="text"]').forEach(el=>{
        el.contentEditable = 'plaintext-only';
      });
      // For chips, keep the close button at end
      $$('#skills-list .chip').forEach(chip=>{
        chip.contentEditable = 'plaintext-only';
      });
    }
    function disableEditable() {
      $$('[data-edit="text"]').forEach(el=>{
        el.contentEditable = 'false';
      });
      $$('#skills-list .chip').forEach(chip=>{
        chip.contentEditable = 'false';
      });
    }

    function handleEditableClicks(e){
      if (!document.body.classList.contains('editing')) return;
      const t = e.target;
      // Image edit
      const img = t.closest && t.closest('img[data-edit="src"]');
      if (img) {
        e.preventDefault();
        openImagePicker(img);
        return;
      }
      // Link edit
      const a = t.closest && t.closest('a[data-edit="href"]');
      if (a) {
        e.preventDefault();
        const url = prompt('Enter URL', a.getAttribute('href') || '#');
        if (url !== null) {
          a.setAttribute('href', url);
        }
        return;
      }
      // Email edit
      const em = t.closest && t.closest('[data-edit="email"]');
      if (em) {
        e.preventDefault();
        const current = em.textContent.trim();
        const val = prompt('Enter email address', current || 'you@example.com');
        if (val !== null && val.trim()) {
          em.textContent = val.trim();
          em.setAttribute('href', `mailto:${val.trim()}`);
          // also reflect in any other email elements
          $$('[data-edit="email"]').forEach(e2=>{
            e2.textContent = val.trim();
            e2.setAttribute('href', `mailto:${val.trim()}`);
          });
        }
        return;
      }
    }

    function openImagePicker(imgEl) {
      const choice = confirm('OK = Upload file, Cancel = Enter image URL');
      if (choice) {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = async () => {
          const file = input.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = () => { imgEl.src = reader.result; };
          reader.readAsDataURL(file);
        };
        input.click();
      } else {
        const url = prompt('Enter image URL', imgEl.getAttribute('src') || '');
        if (url !== null) {
          imgEl.src = url.trim();
        }
      }
    }

    function composeMailto(ev){
      ev.preventDefault();
      const data = new FormData(ev.target);
      const name = data.get('name');
      const from = data.get('from');
      const message = data.get('message');
      const to = currentData.contact?.email || defaultData.contact.email;
      const subject = encodeURIComponent(`Portfolio contact from ${name}`);
      const body = encodeURIComponent(`${message}\n\n— ${name}\n${from}`);
      window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
      return false;
    }

    // Export / Import
    function download(filename, text) {
      const a = document.createElement('a');
      a.href = URL.createObjectURL(new Blob([text],{type:'application/json'}));
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
    }

    // State
    let currentData = loadData();

    // Initial render
    document.addEventListener('DOMContentLoaded', ()=>{
      applyData(currentData);
      // Theme input
      const colorInput = $('#themeColor');
      if (colorInput) {
        colorInput.value = currentData.theme?.primary || defaultData.theme.primary;
        colorInput.addEventListener('input', (e)=>{
          const val = e.target.value;
          applyTheme(val);
        });
        colorInput.addEventListener('change', (e)=>{
          const val = e.target.value;
          currentData.theme.primary = val;
          saveData(currentData);
        });
      }

      // Edit controls
      const editToggle = $('#editToggle');
      const editbar = $('#editbar');
      const saveBtn = $('#saveBtn');
      const exportBtn = $('#exportBtn');
      const importInput = $('#importInput');
      const resetBtn = $('#resetBtn');
      const exitBtn = $('#exitEditBtn');
      const addSkillBtn = $('#add-skill');

      editToggle.addEventListener('click', ()=>{
        const on = !document.body.classList.contains('editing');
        document.body.classList.toggle('editing', on);
        editToggle.setAttribute('aria-pressed', String(on));
        editbar.style.display = on ? 'block' : 'none';
        if (on) enableEditable(); else disableEditable();
      });
      exitBtn.addEventListener('click', ()=>{
        document.body.classList.remove('editing');
        editToggle.setAttribute('aria-pressed', 'false');
        editbar.style.display = 'none';
        disableEditable();
      });
      saveBtn.addEventListener('click', ()=>{
        currentData = collectData();
        saveData(currentData);
        alert('Saved your changes to this browser.');
      });
      exportBtn.addEventListener('click', ()=>{
        const data = collectData();
        download('portfolio-data.json', JSON.stringify(data, null, 2));
      });
      importInput.addEventListener('change', async (e)=>{
        const file = e.target.files?.[0];
        if (!file) return;
        try {
          const text = await file.text();
          const obj = JSON.parse(text);
          currentData = deepMerge(defaultData, obj);
          applyData(currentData);
          saveData(currentData);
          alert('Imported data and saved to this browser.');
        } catch (err) {
          alert('Failed to import JSON: ' + err.message);
        } finally {
          e.target.value = '';
        }
      });
      resetBtn.addEventListener('click', ()=>{
        if (confirm('Reset all content to template defaults? This will clear saved data.')) {
          localStorage.removeItem(STORAGE_KEY);
          currentData = structuredClone(defaultData);
          applyData(currentData);
          alert('Reset complete.');
        }
      });
      addSkillBtn.addEventListener('click', ()=>{
        currentData.skills.push('New skill');
        renderSkills(currentData.skills);
        if (document.body.classList.contains('editing')) enableEditable();
      });

      // Global capture for editable interactions
      document.addEventListener('click', handleEditableClicks, true);

      // Ensure all [data-edit] elements show hint in edit mode
      $$('[data-edit]').forEach(el=>{
        if (!el.querySelector('.hint') && (el.tagName !== 'A' && el.tagName !== 'IMG')) {
          const hint = document.createElement('span');
          hint.className = 'hint';
          hint.textContent = 'Edit';
          el.appendChild(hint);
        }
      });

      // Sync multiple name fields
      const nameObserver = new MutationObserver(()=>{
        const v = $('[data-key="hero.name"]')?.innerText?.trim();
        if (v) $$('#site-title,[data-key="hero.name"]').forEach(el=>{ if (el !== document.activeElement) el.innerText = v; });
      });
      const nameEl = $('[data-key="hero.name"]');
      if (nameEl) nameObserver.observe(nameEl, {characterData:true,subtree:true,childList:true});

      // Keep email buttons in sync
      const emailSync = new MutationObserver(()=>{
        const email = $('[data-edit="email"]')?.textContent?.trim();
        if (!email) return;
        $$('[data-edit="email"]').forEach(el=>{
          el.textContent = email;
          el.href = `mailto:${email}`;
        });
      });
      $$('[data-edit="email"]').forEach(el=>{
        emailSync.observe(el, {characterData:true,subtree:true,childList:true});
      });
    });
  </script>
</body>
</html>